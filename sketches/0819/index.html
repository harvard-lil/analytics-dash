<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <link href="style.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        Search for a subject: <input id="search-field" type="text" value=""></input><input id="search" type="submit"/></br>
        <div id="sort">
        	<div class="y_toggle">
		       	y-sort by: <span id="grads" name="grads">grads</span> /
		        <span id="undergrads" name="undergrads">undergrads</span>  /
		        <span id="faculty" name="faculty">faculty</span>  /
		        <span id="popularity_y" name="Shelf_Rank">popularity</span>  /
		        <span id="date_y" name="Date_of_Publish">publication date</span>  /
		        <span id="call_number_sort_order_y" name="LOC_Sort_Order" class="selected">subject</span>
		    </div>
	        <div class="x_toggle">
		       x-sort by:   <span id="chronological_x" name="x_chronological" class="selected">publication date</span>  /
		        <span id="call_number_sort_order_x" name="call-number-sort-order">call-number</span>
		    </div>
	        <div class="scale_toggle">
			       scale by:   <span id="pages" name="pages">pages</span>  /
			       <span id="same" name="same">same</span>  /
			       <span id="shelfrank" name="popularity" class="selected">popularity</span>
            </div>
        </div>

        <svg id="nav"></svg>
        <div id="carrel">
            <!-- <p>Drag items into the carrel for safekeeping</p> -->
            <a id="export-carrel">Export as spreadsheet</a>
        </div>

        <div id="graph"></div>

        <div id="histogram">
            <label for="amount">Date Range:</label>
            <span id="amount"></span>
            <div id="slider-range"></div>
        </div>

        <div id="info">
            <a id="add-to-carrel">Add to carrel</a>
            <h2 id="title"></h2>
            <p class="infoLabel">Subject:</p>
  			<p id="letter">
  				<span></span>
  				<div id="subject"></div>
  			</p>
            <p class="infoLabel">Authors:</p>
            <ul id="creator"></ul>
            <p class="infoLabel">Publisher information: </p>
            <p id="publisher">
            	<span></span>
            	<div id="pub_location"><span></span></div>
            	<div id="pub_date_numeric"><span></span></div>
            </p>
            <p class="infoLabel">Call Number: </p>
            <p id="lc"><span></span></p>
         	<div id="subject"></div>
        	<p class="infoLabel">Format: </p>
         	<p id="format"><span></span></p>
           	<p class="infoLabel">Multiheadings: </p>
         	<ul id="lcsh"></ul>
	        <!-- <p class="infoLabel">Shelfrank: </p>
            <p id="shelfrank"><span></span></p>
         	<p id="fac_score">Faculty Circulation Score: <span></span></p>
         	<p id="grad_score">Graduate Circulation Score: <span></span></p>
         	<p id="undergrad_score">Undergraduate Circulation Score: <span></span></p>
			<p id="reserve_score">Reserve Circulation Score: <span></span></p> -->
        </div>
        <div id=bookCounts>
			<p id="countsOfBooks"><span></span></p>
        </div>
    </body>
    <script type="text/javascript" src="lib/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="js/stalactites.js"></script>
    <script type="text/javascript" src="js/schema.js"></script>
    <script type="text/javascript" src="js/carrel.js"></script>
    <script type="text/javascript" src="js/histogram.js"></script>
    <script type="text/javascript" src="js/graph.js"></script>
    <script type="text/javascript">

    var getQueryVariable = function(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return(false);
    };

// This just takes what's in the search box and adds an "&" between words.

    var axes = d3.select(".axes");

    var baseurl = 'http://librarycloud.law.harvard.edu/v1/api/item/',
        api = baseurl + '?filter=collection:hollis_catalog&filter={filter}:{keyword}&limit=250&facet=pub_date_numeric&key=5239997b68e033fbf2854d77c6295310',
        search = getQueryVariable('search') || 'los angeles';

    $("#search").click(function() {
        search = $("#search-field").val();
        axes.select("#searchTerm").text("Searching for... '"+search+"'");
        runSearch("lcsh_keyword",search);
    });

    var runSearch = function(filter, keyword) {
    	var url = api.replace('{filter}',filter).replace('{keyword}',keyword);
        $.ajax({
            url: url,
            success: function(response) {
                lc.graph.dataPrep(response.docs);
                
             	lc.graph.drawArea(response.facets);
				lc.graph.updateHistoryBar(response.facets);

                axes.select("#searchTerm").text(filter+": "+keyword);

            	lc.graph.appendCircles(response.docs);
                lc.histogram.appendHistogram(response.docs);
            }
        });
    };

    // initial search request
    runSearch("lcsh_keyword", search);

	var lcObjectArray = [
		{
		name: "A",
		color: "#ff0000",
		subject: "General Works"
		},
		{
		name: "B",
		color: "#ff3800",
		subject: "Philosophy, Psychology, Religion"
		},
		{
		name: "C",
		color: "#ff7000",
		subject: "Auxillary Sciences of History"
		},
		{
		name: "D",
		color: "#ffa800",
		subject: "History: General & Outside the Americas"
		},
		{
		name: "E",
		color: "#ffe000",
		subject: "History: United States"
		},
		{
		name: "F",
		color: "#e6ff00",
		subject:  "History: United States Local & America"
		},
		{
		name: "G",
		color: "#adff00",
		subject:  "Geography, Anthropology, Recreation"
		},
		{
		name: "H",
		color: "#75ff00",
		subject:  "Social Sciences"
		},
		{
		name: "J",
		color: "#05ff00",
		subject:  "Political Science"
		},
		{
		name: "K",
		color: "#00ff33",
		subject:  "Law"
		},
		{
		name: "L",
		color: "#00ff6b",
		subject:  "Education"
		},
		{
		name: "M",
		color: "#00ffa3",
		subject:  "Music"
		},
		{
		name: "N",
		color: "#00ffdb",
		subject:  "Fine Arts"
		},
		{
		name: "P",
		color: "#00b3ff",
		subject:  "Language and Literature"
		},
		{
		name: "Q",
		color: "#007aff",
		subject:  "Science"
		},
		{
		name: "R",
		color: "#00b3ff",
		subject:  "Medicine"
		},
		{
		name: "S",
		color: "#0042ff",
		subject:  "Science"
		},
		{
		name: "T",
		color: "#000aff",
		subject:  "Agriculture"
		},
		{
		name: "U",
		color: "#6600ff",
		subject:  "Military Science"
		},
		{
		name: "V",
		color: "#9e00ff",
		subject:  "Naval Science"
		},
		{
		name: "Z",
		color: "#ff0080",
		subject:  "Library Science & Information Resources"
		}
	];
    </script>
</html>
